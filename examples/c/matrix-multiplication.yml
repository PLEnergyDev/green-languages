name: matrix-multiplication
language: c
description: |
    Create two square matrices of size NÃ—N.
    Each cell within these two matrices will be initialized with the sum of their row and column indices.
    Multiply the two matrices and output the contents of the last cell.
code: |
    #include <stdio.h>
    #include <stdlib.h>
    #include <singals.h>

    void run_benchmark(int argc, char **argv) {
        int n = atoi(argv[1]);
        int repetitions = (argc > 2) ? atoi(argv[2]) : 1000;

        double *A = malloc(n * n * sizeof(double));
        double *B = malloc(n * n * sizeof(double));
        double *C = malloc(n * n * sizeof(double));

        for (int i = 0; i < n; i++) {
            for (int j = 0; j < n; j++) {
                A[i*n + j] = B[i*n + j] = i + j;
            }
        }

        double total_result = 0.0;
        for (int rep = 0; rep < repetitions; rep++) {
            for (int i = 0; i < n; i++) {
                for (int j = 0; j < n; j++) {
                    double sum = 0.0;
                    for (int k = 0; k < n; k++) {
                        sum += A[i*n + k] * B[k*n + j];
                    }
                    C[i*n + j] = sum;
                }
            }
            total_result += C[n*n - 1];
        }

        printf("%.0f\n", total_result / repetitions);
        free(A);
        free(B);
        free(C);
    }

    int main(int argc, char **argv) {
        while (1) {
            if (!start_gl()) break;
            run_benchmark(argc, argv);
            end_gl();
        }
        return 0;
    }
arguments: [200, 1000]
compile_options: [-pipe, -O3, -march=native, -fomit-frame-pointer]
expected_stdout: !!binary |
    MTg0ODcxMDAK
---
name: O3
mode: internal
---
name: O3
mode: external
