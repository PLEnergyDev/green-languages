name: division-loop
language: c
description: |
    Consider for a given M the problem of finding the least integer n such that 1/1 + 1/2 + 1/3 + ... + 1/n >= M.
    For M = 20 the answer is n = 272400600 and the loop performs that many iterations.
    Each iteration involves a floating-point comparison, a floating-point division and a floating-point addition, as well as an integer increment.
code: |
    #include <stdio.h>
    #include <stdlib.h>
    #include <singals.h>

    void run_benchmark(int argc, char **argv) {
        int m = atoi(argv[1]);
        double sum = 0.0;
        int n = 0;
        while (sum < m) {
            n++;
            sum += 1.0 / n;
        }
        printf("%d\n", n);
    }

    int main(int argc, char **argv) {
        while (1) {
            if (!start_gl()) break;
            run_benchmark(argc, argv);
            end_gl();
        }
        return 0;
    }
arguments: [20]
compile_options: [-pipe, -O3, -march=native, -fomit-frame-pointer]
expected_stdout: !!binary |
    MjcyNDAwNjAwCg==
---
name: O3
mode: internal
---
name: O3
mode: external
